# Исправление маски ввода телефона

## Проблема

Маска ввода телефона не работала корректно при вводе казахстанских номеров в формате `77789171790`.

## Решение

Создан новый компонент `PhoneInput` с правильной обработкой казахстанских номеров телефона.

## Возможности компонента

### Автоматическое форматирование

- **Ввод:** `77789171790`
- **Отображение:** `+7 (778) 917-17-90`

### Поддержка различных форматов ввода

Компонент автоматически обрабатывает:
- `77789171790` → `+7 (778) 917-17-90`
- `87789171790` → `+7 (778) 917-17-90` (8 заменяется на 7)
- `7789171790` → `+7 (778) 917-17-90`
- `+77789171790` → `+7 (778) 917-17-90`

### Валидация

- Разрешены только цифры
- Автоматическое ограничение до 11 цифр (7 + 10 цифр)
- Поддержка клавиш навигации (Backspace, Delete, стрелки и т.д.)
- Поддержка Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X

### Визуальные подсказки

- Иконка телефона слева
- Placeholder: `+7 (___) ___-__-__`
- Подсказка под полем: "Формат: +7 (777) 123-45-67"

## Использование

### Базовое использование

```tsx
import { PhoneInput } from '@/components/ui/PhoneInput';

function MyComponent() {
  const [phone, setPhone] = useState('');

  return (
    <PhoneInput
      value={phone}
      onChange={setPhone}
    />
  );
}
```

### С label и required

```tsx
<PhoneInput
  label="Номер телефона"
  value={phone}
  onChange={setPhone}
  required
/>
```

### С кастомным placeholder

```tsx
<PhoneInput
  label="Телефон работодателя"
  value={phone}
  onChange={setPhone}
  placeholder="+7 (___) ___-__-__"
  required
/>
```

## Где применено

Компонент `PhoneInput` заменил обычные `Input` с `type="tel"` в следующих местах:

1. **Страница авторизации** (`frontend/app/auth/page.tsx`)
   - Ввод номера телефона для входа

2. **Маршрутный лист** (`frontend/app/dashboard/clinic/route-sheet/page.tsx`)
   - Поиск пациента по номеру телефона

3. **Управление врачами** (`frontend/app/dashboard/clinic/doctors/page.tsx`)
   - Ввод телефона врача

4. **Договоры** (`frontend/app/dashboard/clinic/contracts/page.tsx`)
   - Ввод телефона работодателя

5. **Сотрудники работодателя** (`frontend/app/dashboard/employer/employees/page.tsx`)
   - Ввод телефона сотрудника

## Технические детали

### Компонент: `frontend/components/ui/PhoneInput.tsx`

**Основные функции:**

1. `formatPhoneNumber(input: string): string`
   - Форматирует номер в вид `+7 (XXX) XXX-XX-XX`
   - Обрабатывает различные форматы ввода
   - Заменяет 8 на 7 в начале номера

2. `getCleanNumber(input: string): string`
   - Возвращает только цифры
   - Нормализует номер (8 → 7)

3. `handleChange(e: React.ChangeEvent<HTMLInputElement>)`
   - Обрабатывает изменения в поле
   - Форматирует отображаемое значение
   - Передает чистый номер в onChange

4. `handleKeyDown(e: React.KeyboardEvent<HTMLInputElement>)`
   - Разрешает только цифры и служебные клавиши
   - Блокирует ввод букв и спецсимволов

### Props

```typescript
interface PhoneInputProps {
  value: string;              // Значение (только цифры)
  onChange: (value: string) => void;  // Callback с чистым номером
  placeholder?: string;       // Placeholder (по умолчанию: '+7 (___) ___-__-__')
  required?: boolean;         // Обязательное поле
  className?: string;         // Дополнительные CSS классы
  label?: string;            // Label над полем
}
```

## Примеры работы

### Пример 1: Ввод полного номера

```
Пользователь вводит: 77789171790
Отображается: +7 (778) 917-17-90
Передается в onChange: 77789171790
```

### Пример 2: Ввод с 8

```
Пользователь вводит: 87789171790
Отображается: +7 (778) 917-17-90
Передается в onChange: 77789171790
```

### Пример 3: Постепенный ввод

```
Ввод: 7
Отображение: +7

Ввод: 77
Отображение: +7 (7

Ввод: 777
Отображение: +7 (77

Ввод: 7778
Отображение: +7 (777) 8

Ввод: 77789
Отображение: +7 (777) 89

И так далее...
```

## Тестирование

### Ручное тестирование

1. Откройте http://localhost:3001/auth
2. Попробуйте ввести номер: `77789171790`
3. Проверьте, что отображается: `+7 (778) 917-17-90`
4. Попробуйте ввести с 8: `87789171790`
5. Проверьте, что также отображается: `+7 (778) 917-17-90`

### Проверка в других местах

1. **Маршрутный лист:** `/dashboard/clinic/route-sheet`
2. **Врачи:** `/dashboard/clinic/doctors`
3. **Договоры:** `/dashboard/clinic/contracts`
4. **Сотрудники:** `/dashboard/employer/employees`

## Совместимость

- ✅ React 18+
- ✅ Next.js 14+
- ✅ TypeScript
- ✅ Dark mode
- ✅ Tailwind CSS

## Обновление в Docker

```bash
# Перезапуск frontend контейнера
docker restart crm-frontend-dev

# Проверка логов
docker logs crm-frontend-dev --tail 50
```

## Дополнительные улучшения

В будущем можно добавить:
- Поддержка международных номеров
- Валидация длины номера
- Проверка существования номера
- Автоматическое определение оператора
- Подсветка некорректных номеров
