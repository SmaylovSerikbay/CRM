# Тестирование генерации PDF календарного плана

## Предварительные требования

1. Backend должен быть запущен
2. Frontend должен быть запущен
3. Должен быть создан хотя бы один календарный план

## Шаги тестирования

### 1. Создание тестового календарного плана

1. Войдите в систему как клиника
2. Перейдите на страницу "Календарный план" (`/dashboard/clinic/calendar-plan`)
3. Нажмите кнопку "Создать план"
4. Заполните форму:
   - Выберите договор
   - Выберите объект/участок
   - Укажите даты
   - (Опционально) Выберите вредные факторы и врачей
5. Нажмите "Создать календарный план"

### 2. Генерация PDF

1. В списке календарных планов найдите созданный план
2. Нажмите кнопку "Генерировать PDF" (для черновиков) или "Скачать PDF" (для утвержденных)
3. Проверьте, что:
   - Появилось уведомление "Генерация PDF..."
   - Файл автоматически скачался
   - Появилось уведомление "PDF успешно сгенерирован и скачан"

### 3. Проверка содержимого PDF

Откройте скачанный PDF файл и проверьте:

- ✅ Заголовок "Календарный план медицинских осмотров"
- ✅ Информация о договоре (если указан)
- ✅ Объект/участок
- ✅ Период проведения осмотров
- ✅ Количество сотрудников
- ✅ Статус плана
- ✅ Таблица участков (если выбрано несколько)
- ✅ Список вредных факторов (если указаны)
- ✅ Таблица врачей (если указаны)
- ✅ Дата создания документа в футере

## Тестирование через API (curl)

```bash
# Получить список календарных планов
curl -X GET "http://localhost:8000/api/calendar-plans/?user_id=YOUR_USER_ID" \
  -H "Content-Type: application/json" \
  --cookie "sessionid=YOUR_SESSION_ID"

# Скачать PDF для конкретного плана
curl -X GET "http://localhost:8000/api/calendar-plans/PLAN_ID/export_pdf/" \
  -H "Content-Type: application/json" \
  --cookie "sessionid=YOUR_SESSION_ID" \
  --output calendar_plan.pdf
```

## Возможные ошибки и решения

### Ошибка: "ReportLab library not installed"
**Решение:** Установите reportlab в backend:
```bash
cd backend
pip install reportlab
```

### Ошибка: "Ошибка генерации PDF"
**Решение:** 
1. Проверьте логи backend
2. Убедитесь, что календарный план существует
3. Проверьте, что у пользователя есть доступ к плану

### PDF не скачивается
**Решение:**
1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что backend доступен
3. Проверьте настройки CORS в backend

## Проверка производительности

- Генерация PDF для плана с 1 участком: ~1-2 секунды
- Генерация PDF для плана с 5 участками: ~2-3 секунды
- Генерация PDF для плана с 10 участками и врачами: ~3-5 секунд

## Браузерная совместимость

Протестировано в:
- ✅ Chrome/Edge (рекомендуется)
- ✅ Firefox
- ✅ Safari
