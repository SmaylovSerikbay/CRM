# üî• Hot Deploy - –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏

## –ß—Ç–æ —ç—Ç–æ?

Hot Deploy - —ç—Ç–æ —Å–ø–æ—Å–æ–± –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ **–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–æ–≤**. –í–º–µ—Å—Ç–æ 2-15 –º–∏–Ω—É—Ç –¥–µ–ø–ª–æ—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç **5-30 —Å–µ–∫—É–Ω–¥**.

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Hot Deploy –∫–æ–≥–¥–∞:
- –ò–∑–º–µ–Ω–∏–ª–∏ —Ç–æ–ª—å–∫–æ –∫–æ–¥ (Python, TypeScript, React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –±–∞–≥
- –û–±–Ω–æ–≤–∏–ª–∏ —Ç–µ–∫—Å—Ç, —Å—Ç–∏–ª–∏, UI
- –ò–∑–º–µ–Ω–∏–ª–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- **–ù–ï –∏–∑–º–µ–Ω—è–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** (requirements.txt, package.json)

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Hot Deploy –∫–æ–≥–¥–∞:
- –î–æ–±–∞–≤–∏–ª–∏/–æ–±–Ω–æ–≤–∏–ª–∏ Python –ø–∞–∫–µ—Ç—ã (requirements.txt)
- –î–æ–±–∞–≤–∏–ª–∏/–æ–±–Ω–æ–≤–∏–ª–∏ npm –ø–∞–∫–µ—Ç—ã (package.json)
- –ò–∑–º–µ–Ω–∏–ª–∏ Dockerfile
- –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker
- –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç–∞

–í —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make bg-auto-fast` –∏–ª–∏ `make bg-auto-full`.

## –ö–æ–º–∞–Ω–¥—ã

### üî• Hot Deploy –≤—Å–µ–≥–æ (backend + frontend)
```bash
make hot
```
**–í—Ä–µ–º—è:** ~30 —Å–µ–∫—É–Ω–¥

### üî• Hot Deploy —Ç–æ–ª—å–∫–æ backend
```bash
make hot-backend
```
**–í—Ä–µ–º—è:** ~5 —Å–µ–∫—É–Ω–¥

### üî• Hot Deploy —Ç–æ–ª—å–∫–æ frontend
```bash
make hot-frontend
```
**–í—Ä–µ–º—è:** ~20 —Å–µ–∫—É–Ω–¥

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### Backend (Python/Django):
1. –ö–æ–ø–∏—Ä—É–µ—Ç –∫–æ–¥ –≤ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª HUP –ø—Ä–æ—Ü–µ—Å—Å—É gunicorn
3. Gunicorn –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç worker'—ã —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
4. **–ë–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞!**

### Frontend (Next.js):
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç `npm run build` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –Ω–æ–≤–æ–π —Å–±–æ—Ä–∫–æ–π
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–∞—É–Ω—Ç–∞–π–º (~2-3 —Å–µ–∫—É–Ω–¥—ã)**

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –±–∞–≥ –≤ backend
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
git add backend/api/views.py
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ –≤ API"
git push

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/projects/CRM
git pull
make hot-backend
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Backend –æ–±–Ω–æ–≤–ª–µ–Ω –∑–∞ 5 —Å–µ–∫—É–Ω–¥!

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–∏–ª–∏ UI –≤–æ frontend
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
git add frontend/app/dashboard/
git commit -m "feat: –æ–±–Ω–æ–≤–ª–µ–Ω –¥–∏–∑–∞–π–Ω –¥–∞—à–±–æ—Ä–¥–∞"
git push

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/projects/CRM
git pull
make hot-frontend
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Frontend –æ–±–Ω–æ–≤–ª–µ–Ω –∑–∞ 20 —Å–µ–∫—É–Ω–¥!

### –ü—Ä–∏–º–µ—Ä 3: –ò–∑–º–µ–Ω–∏–ª–∏ –∏ backend –∏ frontend
```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
git add .
git commit -m "feat: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è"
git push

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~/projects/CRM
git pull
make hot
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞ 30 —Å–µ–∫—É–Ω–¥!

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–ø–ª–æ—è

| –ú–µ—Ç–æ–¥ | –í—Ä–µ–º—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------|-------|-------------------|
| `make hot-backend` | **~5 —Å–µ–∫** | –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ backend –∫–æ–¥–µ |
| `make hot-frontend` | **~20 —Å–µ–∫** | –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ frontend –∫–æ–¥–µ |
| `make hot` | **~30 —Å–µ–∫** | –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±–æ–∏—Ö |
| `make bg-auto-fast` | **~2-3 –º–∏–Ω** | –ò–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| `make bg-auto-full` | **~10-15 –º–∏–Ω** | –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ |

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∞–∫—Ç–∏–≤–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º** - –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (blue –∏–ª–∏ green)
2. **–ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã, –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
3. **Frontend —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏** - Next.js –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å, –Ω–æ —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —á–µ–º Docker build
4. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–∞—Ç–∞** - –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make bg-rollback`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

Hot Deploy –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- Backend –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞ (gunicorn HUP)
- Frontend –∏–º–µ–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–∞—É–Ω—Ç–∞–π–º (~2-3 —Å–µ–∫)
- –ù–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ù–µ –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–ù–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Blue-Green deployment (`make bg-auto-fast`).

## Troubleshooting

### –û—à–∏–±–∫–∞: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
make bg-status

# –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏—Ö
make bg-auto-fast
```

### Backend –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker logs crm-backend-blue-1 --tail 50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
docker restart crm-backend-blue-1
```

### Frontend –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏
docker logs crm-frontend-blue-1 --tail 100

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
make bg-auto-fast
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –º–µ–ª–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make hot`
2. **–î–ª—è –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make bg-auto-fast` (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞)
3. **–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make bg-auto-fast` –∏–ª–∏ `make bg-auto-full`
4. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

## Workflow

```bash
# 1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
npm run dev  # –∏–ª–∏ python manage.py runserver

# 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

# 3. –ö–æ–º–º–∏—Ç –∏ –ø—É—à
git add .
git commit -m "feat: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è"
git push

# 4. –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh ubuntu@82.115.48.40
cd ~/projects/CRM
git pull

# 5. –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ –¥–µ–ø–ª–æ—è:
# - –¢–æ–ª—å–∫–æ –∫–æ–¥ –∏–∑–º–µ–Ω–∏–ª—Å—è? -> make hot
# - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å? -> make bg-auto-fast
# - –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ? -> make bg-auto-fast (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞)

make hot  # –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π!

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞
curl https://crm.archeo.kz/api/health/
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å alias –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–µ–ø–ª–æ—è:

```bash
# –í ~/.bashrc –∏–ª–∏ ~/.zshrc
alias deploy-hot='cd ~/projects/CRM && git pull && make hot'
alias deploy-fast='cd ~/projects/CRM && git pull && make bg-auto-fast'
```

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ:
```bash
deploy-hot  # –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π
```
