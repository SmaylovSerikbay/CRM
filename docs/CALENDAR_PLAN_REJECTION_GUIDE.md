# Руководство по отклонению календарных планов

## Обзор функциональности

Работодатель теперь может отклонить календарный план с указанием причины. Это позволяет клинике понять, что именно нужно исправить в плане.

## Как это работает

### Для работодателя

1. **Просмотр календарных планов**
   - Перейдите в раздел "Договоры" → выберите договор → вкладка "План"
   - Или используйте отдельную страницу "Календарный план"

2. **Отклонение плана**
   - Найдите план со статусом "Ожидает утверждения работодателем"
   - Нажмите кнопку "Отклонить" (красная кнопка с иконкой X)
   - В открывшемся модальном окне укажите причину отклонения
   - Нажмите "Отклонить план"

3. **Примеры причин отклонения**
   - "Сотрудник Иванов И.И. уволился 15.12.2024"
   - "Даты не подходят, перенесите на следующий месяц"
   - "Требуется добавить нового сотрудника Петрова П.П."
   - "Неправильно указан участок для сотрудника Сидорова С.С."

### Для клиники

1. **Просмотр отклоненных планов**
   - В разделе "Договоры" → выберите договор → вкладка "План"
   - Отклоненные планы отмечены красным статусом "Отклонен работодателем"

2. **Просмотр причины отклонения**
   - Причина отклонения отображается в красном блоке под планом
   - Указана дата и время отклонения

3. **Исправление плана**
   - Нажмите "Редактировать" для перевода плана в черновик
   - Внесите необходимые изменения согласно причине отклонения
   - Повторно отправьте план на утверждение

## Статусы календарного плана

- **Черновик** - план создается клиникой
- **Ожидает утверждения клиникой** - внутреннее утверждение
- **Ожидает утверждения работодателем** - план отправлен работодателю
- **Утвержден** - план утвержден обеими сторонами
- **Отклонен работодателем** - план отклонен с указанием причины
- **Отправлен в СЭС** - план направлен в санэпидслужбу

## Технические детали

### API изменения

- `PATCH /api/calendar-plans/{id}/` с параметрами:
  - `status: "rejected"`
  - `rejection_reason: "текст причины"`

### Поля в базе данных

- `rejection_reason` - текст причины отклонения
- `rejected_by_employer_at` - дата и время отклонения

### Frontend компоненты

- Модальное окно отклонения в `Modal`
- Отображение причины в красном блоке
- Кнопки "Отклонить" и "Утвердить" для работодателя

## Преимущества

1. **Прозрачность** - клиника точно знает, что нужно исправить
2. **Эффективность** - не нужно звонить и выяснять причины
3. **Документирование** - все причины сохраняются в системе
4. **Улучшение качества** - планы становятся более точными

## Решение проблемы

Эта функциональность решает описанную проблему:
- Работодатель может указать, что сотрудник уволился
- Клиника получает точную информацию для корректировки
- Процесс согласования становится более эффективным