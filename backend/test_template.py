"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–∞ Excel —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
"""
import os
import sys
import django

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django –æ–∫—Ä—É–∂–µ–Ω–∏—è
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'crm_backend.settings')
django.setup()

from openpyxl import Workbook
from openpyxl.styles import Font, Alignment, PatternFill
from openpyxl.utils import get_column_letter
from openpyxl.worksheet.datavalidation import DataValidation

def test_template_generation():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏"""
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞...")
    
    wb = Workbook()
    ws = wb.active
    ws.title = "–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∏–Ω–≥–µ–Ω—Ç–∞"

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ws.merge_cells('A1:K1')
    ws['A1'] = '–°–ü–ò–°–û–ö –ª–∏—Ü, –ø–æ–¥–ª–µ–∂–∞—â–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–º—É –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–º—É –æ—Å–º–æ—Ç—Ä—É –≤ 2025 –≥–æ–¥—É'
    ws['A1'].font = Font(bold=True, size=14)
    ws['A1'].alignment = Alignment(horizontal='center', vertical='center')

    # –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—Ä–∏–∫–∞–∑–æ–º
    ws.merge_cells('A2:K2')
    ws['A2'] = '—Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–∫–∞–∑—É –∏.–æ. –ú–∏–Ω–∏—Å—Ç—Ä–∞ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω –æ—Ç 15 –æ–∫—Ç—è–±—Ä—è 2020 –≥–æ–¥–∞ ‚Ññ “ö–† –î–°–ú-131/2020'
    ws['A2'].font = Font(size=10)
    ws['A2'].alignment = Alignment(horizontal='center', vertical='center')

    # –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–≤–∞—Ä—Ç–∞–ª–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º —Å–ø–∏—Å–∫–æ–º
    ws.merge_cells('H3:I3')
    ws['H3'] = '1 –∫–≤–∞—Ä—Ç–∞–ª'
    ws['H3'].font = Font(bold=True)
    ws['H3'].alignment = Alignment(horizontal='center')
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∫–≤–∞—Ä—Ç–∞–ª–∞
    quarter_validation = DataValidation(
        type="list",
        formula1='"1 –∫–≤–∞—Ä—Ç–∞–ª,2 –∫–≤–∞—Ä—Ç–∞–ª,3 –∫–≤–∞—Ä—Ç–∞–ª,4 –∫–≤–∞—Ä—Ç–∞–ª"',
        allow_blank=False,
        showDropDown=False,
        showInputMessage=True,
        showErrorMessage=True
    )
    quarter_validation.error = "‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–∞—Ä—Ç–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞"
    quarter_validation.errorTitle = "–ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ"
    quarter_validation.prompt = "üìã –í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–∞—Ä—Ç–∞–ª:\n‚Ä¢ 1 –∫–≤–∞—Ä—Ç–∞–ª\n‚Ä¢ 2 –∫–≤–∞—Ä—Ç–∞–ª\n‚Ä¢ 3 –∫–≤–∞—Ä—Ç–∞–ª\n‚Ä¢ 4 –∫–≤–∞—Ä—Ç–∞–ª"
    quarter_validation.promptTitle = "–í—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∞–ª–∞"
    ws.add_data_validation(quarter_validation)
    quarter_validation.add('H3:I3')

    # –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
    headers = [
        '‚Ññ –ø/–ø', '–§–ò–û', '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', '–ü–æ–ª', '–û–±—ä–µ–∫—Ç –∏–ª–∏ —É—á–∞—Å—Ç–æ–∫',
        '–ó–∞–Ω–∏–º–∞–µ–º–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å', '–û–±—â–∏–π —Å—Ç–∞–∂', '–°—Ç–∞–∂ –ø–æ –∑–∞–Ω–∏–º–∞–µ–º–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏',
        '–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ–¥–æ—Å–º–æ—Ç—Ä–∞', '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—Ä–µ–¥–Ω–æ—Å—Ç—å', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ'
    ]

    header_row = 4
    for col_idx, header in enumerate(headers, start=1):
        cell = ws.cell(row=header_row, column=col_idx, value=header)
        cell.font = Font(bold=True)
        cell.alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)
        cell.fill = PatternFill(start_color='D3D3D3', end_color='D3D3D3', fill_type='solid')
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∫–æ–ª–æ–Ω–æ–∫ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
        if col_idx == 4:  # –ö–æ–ª–æ–Ω–∫–∞ "–ü–æ–ª"
            from openpyxl.comments import Comment
            comment = Comment(
                "üìã –í–´–ü–ê–î–ê–Æ–©–ò–ô –°–ü–ò–°–û–ö\n\n"
                "–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –Ω–∏–∂–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞:\n"
                "‚Ä¢ –º—É–∂—Å–∫–æ–π\n"
                "‚Ä¢ –∂–µ–Ω—Å–∫–∏–π\n\n"
                "‚ö†Ô∏è –ù–µ –≤–≤–æ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é!",
                "–°–∏—Å—Ç–µ–º–∞"
            )
            comment.width = 300
            comment.height = 120
            cell.comment = comment
        elif col_idx == 10:  # –ö–æ–ª–æ–Ω–∫–∞ "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—Ä–µ–¥–Ω–æ—Å—Ç—å"
            from openpyxl.comments import Comment
            comment = Comment(
                "üìã –í–´–ü–ê–î–ê–Æ–©–ò–ô –°–ü–ò–°–û–ö\n\n"
                "–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –Ω–∏–∂–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞.\n\n"
                "–î–æ—Å—Ç—É–ø–Ω–æ 33 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–∫–∞–∑—É ‚Ññ “ö–† –î–°–ú-131/2020:\n"
                "–ø.1 - –•–∏–º–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã\n"
                "–ø.2 - –ö–∞–Ω—Ü–µ—Ä–æ–≥–µ–Ω–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞\n"
                "–ø.14 - –†–∞–±–æ—Ç–∞ –Ω–∞ –ü–ö\n"
                "–ø.33 - –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã\n"
                "–∏ –¥—Ä—É–≥–∏–µ...\n\n"
                "‚ö†Ô∏è –ù–µ –≤–≤–æ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é!",
                "–°–∏—Å—Ç–µ–º–∞"
            )
            comment.width = 350
            comment.height = 180
            cell.comment = comment

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
    column_widths = [8, 30, 15, 10, 30, 25, 12, 25, 20, 40, 20]
    for col_idx, width in enumerate(column_widths, start=1):
        ws.column_dimensions[get_column_letter(col_idx)].width = width

    # –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫
    ws.row_dimensions[1].height = 30
    ws.row_dimensions[2].height = 20
    ws.row_dimensions[header_row].height = 40

    data_start_row = header_row + 1
    data_end_row = 500

    # 1) –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ "–ü–æ–ª" - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π —Å–ø–∏—Å–æ–∫
    print("–°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ '–ü–æ–ª'...")
    gender_validation = DataValidation(
        type="list",
        formula1='"–º—É–∂—Å–∫–æ–π,–∂–µ–Ω—Å–∫–∏–π"',  # –ü—Ä—è–º–æ–π —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
        allow_blank=True,
        showDropDown=False,  # False –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–µ–ª–∫—É! (–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å openpyxl)
        showInputMessage=True,
        showErrorMessage=True
    )
    gender_validation.error = "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞"
    gender_validation.errorTitle = "–ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ"
    gender_validation.prompt = "üìã –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–µ–ª–∫—É ‚ñº —Å–ø—Ä–∞–≤–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ:\n‚Ä¢ –º—É–∂—Å–∫–æ–π\n‚Ä¢ –∂–µ–Ω—Å–∫–∏–π"
    gender_validation.promptTitle = "–í—ã–±–æ—Ä –ø–æ–ª–∞"
    ws.add_data_validation(gender_validation)
    gender_validation.add(f"D{data_start_row}:D{data_end_row}")
    print(f"  ‚úì –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ D (–ü–æ–ª): –ø—Ä—è–º–æ–π —Å–ø–∏—Å–æ–∫")
    
    # –°–æ–∑–¥–∞–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π –ª–∏—Å—Ç –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    gender_sheet = wb.create_sheet(title="Ref_Gender")
    gender_values = ["–º—É–∂—Å–∫–æ–π", "–∂–µ–Ω—Å–∫–∏–π"]
    for idx, gender in enumerate(gender_values, start=1):
        gender_sheet.cell(row=idx, column=1, value=gender)

    # 2) –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—Ä–µ–¥–Ω–æ—Å—Ç—å"
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—Ä–µ–¥–Ω–æ—Å—Ç—å'...")
    harmful_sheet = wb.create_sheet(title="Ref_Harm")
    
    harmful_factors = [
        "–ø.1 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤¬ª",
        "–ø.2 ¬´–†–∞–±–æ—Ç—ã —Å –∫–∞–Ω—Ü–µ—Ä–æ–≥–µ–Ω–Ω—ã–º–∏ –≤–µ—â–µ—Å—Ç–≤–∞–º–∏¬ª",
        "–ø.3 ¬´–†–∞–±–æ—Ç—ã —Å –ø–µ—Å—Ç–∏—Ü–∏–¥–∞–º–∏ –∏ –∞–≥—Ä–æ—Ö–∏–º–∏–∫–∞—Ç–∞–º–∏¬ª",
        "–ø.4 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤¬ª",
        "–ø.5 ¬´–†–∞–±–æ—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –≤ —É—Å–ª–æ–≤–∏—è—Ö –ø–æ–≤—ã—à–µ–Ω–Ω–æ–≥–æ —à—É–º–∞¬ª",
        "–ø.6 ¬´–†–∞–±–æ—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –≤ —É—Å–ª–æ–≤–∏—è—Ö –≤–∏–±—Ä–∞—Ü–∏–∏¬ª",
        "–ø.7 ¬´–†–∞–±–æ—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –≤ —É—Å–ª–æ–≤–∏—è—Ö –∏–æ–Ω–∏–∑–∏—Ä—É—é—â–µ–≥–æ –∏–∑–ª—É—á–µ–Ω–∏—è¬ª",
        "–ø.8 ¬´–†–∞–±–æ—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –≤ —É—Å–ª–æ–≤–∏—è—Ö –Ω–µ–∏–æ–Ω–∏–∑–∏—Ä—É—é—â–∏—Ö –∏–∑–ª—É—á–µ–Ω–∏–π¬ª",
        "–ø.9 ¬´–†–∞–±–æ—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –∏–ª–∏ –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –≤–æ–∑–¥—É—Ö–∞¬ª",
        "–ø.10 ¬´–†–∞–±–æ—Ç—ã –≤ –∑–∞–º–∫–Ω—É—Ç—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö¬ª",
        "–ø.11 ¬´–†–∞–±–æ—Ç—ã –Ω–∞ –≤—ã—Å–æ—Ç–µ¬ª",
        "–ø.12 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–¥—ä–µ–º–æ–º –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º —Ç—è–∂–µ—Å—Ç–µ–π¬ª",
        "–ø.13 ¬´–†–∞–±–æ—Ç—ã –≤ –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è¬ª",
        "–ø.14 ¬´–†–∞–±–æ—Ç–∞ –Ω–∞ –ü–ö¬ª",
        "–ø.15 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏ —É–º—Å—Ç–≤–µ–Ω–Ω—ã–º –ø–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º¬ª",
        "–ø.16 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é¬ª",
        "–ø.17 ¬´–†–∞–±–æ—Ç—ã –≤–∞—Ö—Ç–æ–≤—ã–º –º–µ—Ç–æ–¥–æ–º¬ª",
        "–ø.18 ¬´–ü–æ–¥–∑–µ–º–Ω—ã–µ —Ä–∞–±–æ—Ç—ã¬ª",
        "–ø.19 ¬´–†–∞–±–æ—Ç—ã –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ¬ª",
        "–ø.20 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –ø—ã–ª–∏¬ª",
        "–ø.21 ¬´–†–∞–±–æ—Ç—ã —Å –≥–æ—Ä—é—á–µ-—Å–º–∞–∑–æ—á–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏¬ª",
        "–ø.22 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –Ω–µ—Ñ—Ç–∏ –∏ –Ω–µ—Ñ—Ç–µ–ø—Ä–æ–¥—É–∫—Ç–æ–≤¬ª",
        "–ø.23 ¬´–†–∞–±–æ—Ç—ã –≤ —É—Å–ª–æ–≤–∏—è—Ö –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –∑–∞–≥–∞–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏¬ª",
        "–ø.24 ¬´–†–∞–±–æ—Ç—ã –≤ —É—Å–ª–æ–≤–∏—è—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –∫–∏—Å–ª–æ—Ä–æ–¥–∞¬ª",
        "–ø.25 ¬´–†–∞–±–æ—Ç—ã –≤ —É—Å–ª–æ–≤–∏—è—Ö –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏¬ª",
        "–ø.26 ¬´–†–∞–±–æ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–∏–±—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º¬ª",
        "–ø.27 ¬´–†–∞–±–æ—Ç—ã –Ω–∞ –∫–æ–Ω–≤–µ–π–µ—Ä–∞—Ö¬ª",
        "–ø.28 ¬´–†–∞–±–æ—Ç—ã –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö¬ª",
        "–ø.29 ¬´–†–∞–±–æ—Ç—ã –≤ –º–µ—Ç–∞–ª–ª—É—Ä–≥–∏—á–µ—Å–∫–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ¬ª",
        "–ø.30 ¬´–†–∞–±–æ—Ç—ã –≤ –≥–æ—Ä–Ω–æ–¥–æ–±—ã–≤–∞—é—â–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏¬ª",
        "–ø.31 ¬´–†–∞–±–æ—Ç—ã –≤ –¥–µ—Ä–µ–≤–æ–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ¬ª",
        "–ø.32 ¬´–†–∞–±–æ—Ç—ã –≤ —Ç–µ–∫—Å—Ç–∏–ª—å–Ω–æ–π –∏ —à–≤–µ–π–Ω–æ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏¬ª",
        "–ø.33 ¬´–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã¬ª"
    ]

    for idx, factor in enumerate(harmful_factors, start=1):
        harmful_sheet.cell(row=idx, column=1, value=factor)

    harmful_range = f"Ref_Harm!$A$1:$A${len(harmful_factors)}"
    harmful_validation = DataValidation(
        type="list",
        formula1=f"={harmful_range}",
        allow_blank=True,
        showDropDown=False,  # False –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–µ–ª–∫—É! (–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å openpyxl)
        showInputMessage=True,
        showErrorMessage=True
    )
    harmful_validation.error = "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –≤—Ä–µ–¥–Ω–æ—Å—Ç—å –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞"
    harmful_validation.errorTitle = "–ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ"
    harmful_validation.prompt = "üìã –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–µ–ª–∫—É —Å–ø—Ä–∞–≤–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤—Ä–µ–¥–Ω–æ—Å—Ç–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–∫–∞–∑—É ‚Ññ “ö–† –î–°–ú-131/2020\n\n–î–æ—Å—Ç—É–ø–Ω–æ 33 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ø.1 - –ø.33)"
    harmful_validation.promptTitle = "–í—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤—Ä–µ–¥–Ω–æ—Å—Ç–∏"
    ws.add_data_validation(harmful_validation)
    harmful_validation.add(f"J{data_start_row}:J{data_end_row}")
    print(f"  ‚úì –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ J (–ü—Ä–æ—Ñ. –≤—Ä–µ–¥–Ω–æ—Å—Ç—å): {harmful_range}")

    # –°–∫—Ä—ã–≤–∞–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –ª–∏—Å—Ç—ã
    print("–°–∫—Ä—ã—Ç–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤...")
    gender_sheet.sheet_state = "hidden"
    harmful_sheet.sheet_state = "hidden"

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    import datetime
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    output_path = f"test_contingent_template_{timestamp}.xlsx"
    wb.save(output_path)
    print(f"\n‚úì –®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {output_path}")
    print(f"  - –û—Å–Ω–æ–≤–Ω–æ–π –ª–∏—Å—Ç: '–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∏–Ω–≥–µ–Ω—Ç–∞'")
    print(f"  - –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –ª–∏—Å—Ç—ã (—Å–∫—Ä—ã—Ç—ã): 'Ref_Gender', 'Ref_Harm'")
    print(f"  - –í—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ D –∏ J")
    print(f"\n–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ Excel –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤!")

if __name__ == "__main__":
    test_template_generation()
