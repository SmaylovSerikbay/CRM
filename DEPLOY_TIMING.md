# –í—Ä–µ–º—è –¥–µ–ø–ª–æ—è - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (make bg-auto)

–¢–µ–ø–µ—Ä—å —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è!

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ‚úì –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û!                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–ê–∫—Ç–∏–≤–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: green
–ü–æ—Ä—Ç—ã: Backend 8002, Frontend 3002

‚è±Ô∏è  –í—Ä–µ–º—è –¥–µ–ø–ª–æ—è: 6 –º–∏–Ω 23 —Å–µ–∫
–í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 14:35:42
```

## –¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (bg-auto):

**–ü–µ—Ä–≤—ã–π —Ä–∞–∑ (–±–µ–∑ –∫—ç—à–∞):**
- Git pull: 5-10 —Å–µ–∫
- –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤: 5-10 –º–∏–Ω
- –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: 30-60 —Å–µ–∫
- Health checks: 30-60 —Å–µ–∫
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞: 30 —Å–µ–∫ (—Ä—É—á–Ω–æ–µ)
- –û—á–∏—Å—Ç–∫–∞: 30 —Å–µ–∫
- **–ò—Ç–æ–≥–æ: 8-15 –º–∏–Ω—É—Ç**

**–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–µ–ø–ª–æ–π (—Å –∫—ç—à–µ–º):**
- Git pull: 5-10 —Å–µ–∫
- –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤: 1-3 –º–∏–Ω ‚ö°
- –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: 30-60 —Å–µ–∫
- Health checks: 30-60 —Å–µ–∫
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞: 30 —Å–µ–∫ (—Ä—É—á–Ω–æ–µ)
- –û—á–∏—Å—Ç–∫–∞: 30 —Å–µ–∫
- **–ò—Ç–æ–≥–æ: 4-7 –º–∏–Ω—É—Ç** ‚ö°

### –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

| –ö–æ–º–∞–Ω–¥–∞ | –ü–µ—Ä–≤—ã–π —Ä–∞–∑ | –° –∫—ç—à–µ–º |
|---------|------------|---------|
| `make bg-deploy` | 6-12 –º–∏–Ω | 2-4 –º–∏–Ω |
| `make bg-switch` | 1-2 –º–∏–Ω | 1-2 –º–∏–Ω |
| `make bg-cleanup` | 10-30 —Å–µ–∫ | 10-30 —Å–µ–∫ |
| `make bg-rollback` | 1-2 –º–∏–Ω | 1-2 –º–∏–Ω |

## –§–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å

### –£—Å–∫–æ—Ä—è—é—Ç:
‚úÖ BuildKit –≤–∫–ª—é—á–µ–Ω (DOCKER_BUILDKIT=1)
‚úÖ –ö—ç—à Docker —Å–ª–æ–µ–≤
‚úÖ package-lock.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚úÖ –ë—ã—Å—Ç—Ä—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
‚úÖ SSD –¥–∏—Å–∫
‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ RAM (8GB+)

### –ó–∞–º–µ–¥–ª—è—é—Ç:
‚ùå --no-cache —Ñ–ª–∞–≥
‚ùå –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞
‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö (requirements.txt, package.json)
‚ùå –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
‚ùå HDD –¥–∏—Å–∫
‚ùå –ú–∞–ª–æ RAM

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à
```bash
# ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ (10-15 –º–∏–Ω)
docker compose build --no-cache

# ‚úÖ –ë—ã—Å—Ç—Ä–æ (2-4 –º–∏–Ω)
docker compose build
```

### 2. –í–∫–ª—é—á–∏—Ç–µ BuildKit
–£–∂–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ `.env.prod`:
```bash
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1
```

### 3. –ù–µ –º–µ–Ω—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–∞—Å—Ç–æ
- Backend: `requirements.txt`
- Frontend: `package.json`

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —ç—Ç–∏—Ö —Ñ–∞–π–ª–∞—Ö —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç –∫—ç—à!

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSD
- HDD: 10-15 –º–∏–Ω—É—Ç
- SSD: 4-7 –º–∏–Ω—É—Ç
- NVMe: 3-5 –º–∏–Ω—É—Ç

### 5. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ RAM
- 4GB: –º–µ–¥–ª–µ–Ω–Ω–æ, –≤–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏
- 8GB: –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- 16GB+: –±—ã—Å—Ç—Ä–æ

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏

### –ë–µ–∑ Blue-Green (–æ–±—ã—á–Ω—ã–π –¥–µ–ø–ª–æ–π):
```bash
docker compose down    # ‚ö†Ô∏è –°–∞–π—Ç –ø–∞–¥–∞–µ—Ç
docker compose build   # 5-10 –º–∏–Ω
docker compose up -d   # 1-2 –º–∏–Ω
# –ò—Ç–æ–≥–æ: 6-12 –º–∏–Ω + DOWNTIME
```

### –° Blue-Green:
```bash
make bg-auto          # 4-7 –º–∏–Ω
# –ò—Ç–æ–≥–æ: 4-7 –º–∏–Ω + ZERO DOWNTIME ‚úÖ
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏

### –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—Ä—É—á–Ω—É—é:

**Linux/Mac:**
```bash
time make bg-auto
```

**Windows PowerShell:**
```powershell
Measure-Command { make bg-auto }
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥ —Å –≤—Ä–µ–º–µ–Ω–µ–º
make bg-auto 2>&1 | tee deploy-$(date +%Y%m%d-%H%M%S).log
```

## –†–µ–∫–æ—Ä–¥—ã —Å–∫–æ—Ä–æ—Å—Ç–∏

### –ù–∞—à –ø—Ä–æ–µ–∫—Ç:
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:** 3 –º–∏–Ω 45 —Å–µ–∫ (—Å –∫—ç—à–µ–º, SSD, 16GB RAM)
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:** 5-6 –º–∏–Ω—É—Ç (—Å –∫—ç—à–µ–º)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:** 12-15 –º–∏–Ω—É—Ç (–±–µ–∑ –∫—ç—à–∞, –ø–µ—Ä–≤—ã–π —Ä–∞–∑)

### –¶–µ–ª–∏:
- ‚úÖ < 10 –º–∏–Ω—É—Ç - –æ—Ç–ª–∏—á–Ω–æ
- ‚ö†Ô∏è 10-15 –º–∏–Ω—É—Ç - –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚ùå > 15 –º–∏–Ω—É—Ç - –Ω—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

## Troubleshooting –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

### –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–ø–ª–æ–π > 15 –º–∏–Ω—É—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å BuildKit
docker buildx version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
docker compose build --progress=plain 2>&1 | grep "Sending build context"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à
docker system df
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–∫–ª—é—á–∏—Ç–µ BuildKit
2. –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã: `docker image prune -a`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .dockerignore
4. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ --no-cache

### –ü—Ä–æ–±–ª–µ–º–∞: npm install –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å package-lock.json
cd frontend
npm install
git add package-lock.json
git commit -m "Add lock file"
```

### –ü—Ä–æ–±–ª–µ–º–∞: pip install –º–µ–¥–ª–µ–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–µ—Ä–∫–∞–ª–æ PyPI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –í backend/Dockerfile –¥–æ–±–∞–≤—å—Ç–µ:
RUN pip install --index-url https://pypi.org/simple -r requirements.txt
```

## –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à** (–Ω–µ --no-cache)
2. **BuildKit —É–∂–µ –≤–∫–ª—é—á–µ–Ω** –≤ .env.prod
3. **–ö–æ–º–º–∏—Ç—å—Ç–µ lock —Ñ–∞–π–ª—ã** (package-lock.json)
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –≤—Ä–µ–º—è** –¥–µ–ø–ª–æ—è
5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ** –µ—Å–ª–∏ > 10 –º–∏–Ω—É—Ç

üéØ **–¶–µ–ª—å: 5-7 –º–∏–Ω—É—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è**

‚úÖ **–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π!**
