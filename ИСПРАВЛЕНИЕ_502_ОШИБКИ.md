# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 502 –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

### –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫?

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `make deploy-all` –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è "y" (—Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç), —Å–∫—Ä–∏–ø—Ç **–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª –ù–û–í–û–ï –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–µ 502.

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

–í —Ñ–∞–π–ª–µ `deploy-blue-green.sh` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

**–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```bash
set_active_color "$inactive"  # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–≤–µ—Ç
sleep 30
docker compose down --profile "$active"  # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ —Ç–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ!
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```bash
local old_environment="$active"  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
set_active_color "$inactive"     # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–≤–µ—Ç  
sleep 30
docker compose down --profile "$old_environment"  # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä–æ–µ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Makefile

‚úÖ –î—É–±–ª–µ–π –∫–æ–º–∞–Ω–¥ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ - –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –û–±—ã—á–Ω—ã–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚≠ê
```bash
make deploy-all
```
- ‚úÖ Git pull + –±—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
- –í—Ä–µ–º—è: ~2-3 –º–∏–Ω—É—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à Docker

### –¢–æ–ª—å–∫–æ backend (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ)
```bash
make hot-pull
```
- Git pull + hot deploy backend
- –í—Ä–µ–º—è: ~10 —Å–µ–∫—É–Ω–¥
- –ë–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Docker

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
```bash
make bg-auto-full
```
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
- –í—Ä–µ–º—è: ~10-15 –º–∏–Ω—É—Ç

## –û—Ç–ª–∏—á–∏–µ `make deploy-all` –æ—Ç `make bg-auto`

### `make deploy-all` ‚≠ê (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
- ‚úÖ **–î–µ–ª–∞–µ—Ç git pull –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º —Å–±–æ—Ä–∫–∏
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
- –í—Ä–µ–º—è: ~2-3 –º–∏–Ω—É—Ç—ã

### `make bg-auto`
- ‚ùå **–ë–ï–ó git pull** (–Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é)
- ‚ùì –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–∏–ø —Å–±–æ—Ä–∫–∏ (–±—ã—Å—Ç—Ä–∞—è/–ø–æ–ª–Ω–∞—è)
- –í—Ä–µ–º—è: ~2-15 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±–æ—Ä–∞)

**–í—ã–≤–æ–¥:** –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make deploy-all` - —ç—Ç–æ –ø—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ!

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```bash
make bg-status
```

### 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```bash
docker compose -f docker-compose.blue-green.yml logs -f
```

### 3. –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è
```bash
make bg-rollback
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ NPM

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø–æ—Ä—Ç—ã –≤ Nginx Proxy Manager.

–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ `.env.prod`:
- `NPM_HOST=http://82.115.48.40:8222`
- `NPM_EMAIL=djek9007@gmail.com`
- `NPM_PASSWORD=Nginx&9007`

## –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å! üöÄ
