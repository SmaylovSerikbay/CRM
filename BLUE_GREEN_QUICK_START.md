# Blue-Green Deployment - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ß—Ç–æ —ç—Ç–æ?

Zero-downtime deployment - –¥–µ–ø–ª–æ–π –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞. –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Ç—Ä–∞—Ñ–∏–∫.

## –ü–æ—Ä—Ç—ã

- **Blue (—Ç–µ–∫—É—â–∞—è):** Backend `8001`, Frontend `3001`
- **Green (–Ω–æ–≤–∞—è):** Backend `8002`, Frontend `3002`

## –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

### üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–µ–ª–∞–µ—Ç –≤—Å—ë: –¥–µ–ø–ª–æ–π ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ ‚Üí –æ—á–∏—Å—Ç–∫–∞

```cmd
# Windows
deploy-blue-green.bat auto

# Linux/Mac
./deploy-blue-green.sh auto

# Make
make bg-auto
```

–°–∫—Ä–∏–ø—Ç:
1. –î–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health checks
3. –ü—Ä–æ—Å–∏—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –≤ NPM
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### –†—É—á–Ω–æ–π (–ø–æ—à–∞–≥–æ–≤—ã–π):

#### Windows:

```cmd
# 1. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
deploy-blue-green.bat deploy

# 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ–∫–∞ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç)
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
http://localhost:8002/api/health/
http://localhost:3002/

# 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞
deploy-blue-green.bat switch
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è Nginx Proxy Manager

# 4. –ï—Å–ª–∏ –≤—Å–µ –û–ö - –æ—á–∏—Å—Ç–∫–∞
deploy-blue-green.bat cleanup

# 5. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã - –æ—Ç–∫–∞—Ç
deploy-blue-green.bat rollback
```

#### Linux/Mac:

```bash
# 1. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
./deploy-blue-green.sh deploy

# 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
curl http://localhost:8002/api/health/
curl http://localhost:3002/

# 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
./deploy-blue-green.sh switch

# 4. –û—á–∏—Å—Ç–∫–∞ –∏–ª–∏ –æ—Ç–∫–∞—Ç
./deploy-blue-green.sh cleanup
./deploy-blue-green.sh rollback
```

#### Make:

```bash
make bg-auto     # üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
make bg-deploy   # –î–µ–ø–ª–æ–π
make bg-switch   # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
make bg-rollback # –û—Ç–∫–∞—Ç
make bg-cleanup  # –û—á–∏—Å—Ç–∫–∞
make bg-status   # –°—Ç–∞—Ç—É—Å
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx Proxy Manager (–æ–¥–∏–Ω —Ä–∞–∑)

### Backend API:
1. –û—Ç–∫—Ä–æ–π—Ç–µ NPM ‚Üí Proxy Hosts
2. –ù–∞–π–¥–∏—Ç–µ `crm.archeo.kz/api` (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ)
3. Forward Hostname/IP: `localhost`
4. Forward Port: `8001` (–Ω–∞—á–∏–Ω–∞–µ–º —Å Blue)

### Frontend:
1. –û—Ç–∫—Ä–æ–π—Ç–µ NPM ‚Üí Proxy Hosts
2. –ù–∞–π–¥–∏—Ç–µ `crm.archeo.kz` (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ)
3. Forward Hostname/IP: `localhost`
4. Forward Port: `3001` (–Ω–∞—á–∏–Ω–∞–µ–º —Å Blue)

## –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ NPM

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `switch`:

1. **Backend:** –ò–∑–º–µ–Ω–∏—Ç–µ Forward Port —Å `8001` –Ω–∞ `8002` (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)
2. **Frontend:** –ò–∑–º–µ–Ω–∏—Ç–µ Forward Port —Å `3001` –Ω–∞ `3002` (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ

## –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# Windows
deploy-blue-green.bat rollback

# Linux/Mac
./deploy-blue-green.sh rollback

# Make
make bg-rollback
```

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –≤ NPM.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# Windows
deploy-blue-green.bat status

# Linux/Mac
./deploy-blue-green.sh status

# Make
make bg-status
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **Zero downtime** - —Å–∞–π—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ  
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è  
‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç** - –∑–∞ —Å–µ–∫—É–Ω–¥—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ  

## –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `docs/BLUE_GREEN_DEPLOYMENT.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
