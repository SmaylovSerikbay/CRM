# Исправление ошибки создания календарного плана

## Проблема
Не удается создать календарный план из-за отсутствия необходимых данных.

## Причины ошибки:

### 1. ❌ Нет контингента сотрудников
В базе данных нет загруженных сотрудников (контингента).

**Решение:**
1. Перейдите в раздел **"Контингент"**
2. Нажмите **"Загрузить из Excel"**
3. Скачайте шаблон Excel (если нужно)
4. Заполните шаблон данными сотрудников
5. Загрузите файл
6. Выберите договор при загрузке

### 2. ✅ Договор не был подтвержден (ИСПРАВЛЕНО)
Договор имел статус "sent" (отправлен), а для создания календарного плана нужен статус "approved" (утвержден).

**Статус:** Исправлено автоматически - договор теперь имеет статус "approved".

## Пошаговая инструкция для создания календарного плана:

### Шаг 1: Загрузите контингент
1. Откройте раздел **"Контингент"** в меню клиники
2. Нажмите кнопку **"Загрузить из Excel"**
3. Если у вас нет файла:
   - Нажмите **"Скачать шаблон"**
   - Заполните шаблон данными сотрудников:
     - ФИО
     - ИИН (12 цифр)
     - Должность
     - Объект/участок
     - Телефон
     - Дата рождения
     - Пол
     - Вредные факторы
4. Загрузите заполненный файл
5. Выберите договор **"Первый договор ЕТП"**
6. Нажмите **"Загрузить"**

### Шаг 2: Проверьте договор
1. Откройте раздел **"Договоры"**
2. Убедитесь, что договор имеет статус **"Утвержден"** (зеленая галочка)
3. Если статус другой:
   - Для клиники: нажмите **"Согласовано"**
   - Для работодателя: нажмите **"Утвердить"**

### Шаг 3: Создайте календарный план
1. Откройте раздел **"Календарный план"**
2. Нажмите **"Создать план"**
3. Заполните форму:
   - **Шаг 1:** Выберите договор
   - **Шаг 2:** Выберите объекты/участки
   - **Шаг 3:** Укажите даты проведения осмотров
   - **Шаг 4:** (Опционально) Выберите вредные факторы и врачей
4. Нажмите **"Создать календарный план"**

### Шаг 4: Генерация PDF
После создания плана:
1. План появится в списке со статусом **"Черновик"**
2. Нажмите кнопку **"Генерировать PDF"**
3. PDF файл скачается автоматически

## Проверка данных в базе:

### Проверить количество сотрудников:
```bash
docker-compose exec backend python manage.py shell -c "from api.models import ContingentEmployee; print(f'Сотрудников: {ContingentEmployee.objects.count()}')"
```

### Проверить статус договора:
```bash
docker-compose exec backend python manage.py shell -c "from api.models import Contract; c = Contract.objects.get(id=1); print(f'Договор: {c.contract_number}, Статус: {c.status}')"
```

### Проверить календарные планы:
```bash
docker-compose exec backend python manage.py shell -c "from api.models import CalendarPlan; print(f'Планов: {CalendarPlan.objects.count()}')"
```

## Типичные ошибки:

### "Необходимо выбрать подтвержденный договор"
**Причина:** Договор не утвержден
**Решение:** Утвердите договор в разделе "Договоры"

### "Не найдено сотрудников для выбранных участков"
**Причина:** Контингент не загружен или загружен без привязки к договору
**Решение:** Загрузите контингент заново, выбрав правильный договор

### "Пожалуйста, выберите хотя бы один объект или участок"
**Причина:** Не выбраны участки на шаге 2
**Решение:** Выберите хотя бы один объект/участок из списка

## Текущий статус:
- ✅ Договор подтвержден (ID: 1, "Первый договор ЕТП")
- ❌ Контингент не загружен (0 сотрудников)
- ❌ Календарные планы не созданы (0 планов)

**Следующий шаг:** Загрузите контингент сотрудников!
